-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.board (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  owner_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  description text,
  CONSTRAINT board_pkey PRIMARY KEY (id),
  CONSTRAINT files_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id)
);
CREATE TABLE public.board_access_links (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  board_id uuid,
  role text NOT NULL CHECK (role = ANY (ARRAY['viewer'::text, 'editor'::text])),
  password_hash text,
  expires_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT board_access_links_pkey PRIMARY KEY (id),
  CONSTRAINT file_access_links_file_id_fkey FOREIGN KEY (board_id) REFERENCES public.board(id)
);
CREATE TABLE public.board_permissions (
  board_id uuid NOT NULL,
  user_id uuid NOT NULL,
  role text NOT NULL CHECK (role = ANY (ARRAY['viewer'::text, 'editor'::text])),
  CONSTRAINT board_permissions_pkey PRIMARY KEY (board_id, user_id),
  CONSTRAINT file_permissions_file_id_fkey FOREIGN KEY (board_id) REFERENCES public.board(id),
  CONSTRAINT file_permissions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.board_snapshots (
  board_id uuid NOT NULL,
  version integer NOT NULL,
  data jsonb NOT NULL,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT board_snapshots_pkey PRIMARY KEY (board_id),
  CONSTRAINT file_snapshots_file_id_fkey FOREIGN KEY (board_id) REFERENCES public.board(id)
);